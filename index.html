<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>al bayan </title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #3E89999957;
            --primary-dark: #13a;
            --primary-light: #4CAF50;
            --gold: #D4AF37;
            --gold-dark: #B8860B;
            --bg-light: #f8f9fa;
            --bg-white: #ffffff;
            --text-dark: #2D3748;
            --text-light: #718096;
            --border-light: #E2E8F0;
            --shadow: 0 50px 25px rgba(0,0,0,0.1);
            --shadow-lg: 0 20px 40px rgba(0,0,0,0.15);
            --radius: 12px;
            --radius-lg: 20px;
        }

        [data-theme="dark"] {
            --bg-light: #1A202C;
            --bg-white: #2D3748;
            --text-dark: #F7FAFC;
            --text-light: #CBD5E0;
            --border-light: #4A5568;
            --shadow: 0 10px 25px rgba(0,0,0,0.3);
            --shadow-lg: 0 20px 40px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hind Siliguri', sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-white) 100%);
            color: var(--text-dark);
            min-height: 100vh;
            transition: all 0.3s ease;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: var(--radius-lg);
            padding: 40px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.1;
        }

        .logo-container {
            text-align: center;
            color: white;
            position: relative;
            z-index: 2;
        }

        .logo {
            font-size: 4rem;
            margin-bottom: 15px;
            display: inline-block;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }

        .title {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            font-weight: 300;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            background: var(--bg-white);
            border-radius: var(--radius);
            padding: 10px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-light);
        }

        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            border-radius: var(--radius);
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--text-light);
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow);
        }

        .nav-tab:hover:not(.active) {
            background: var(--bg-light);
            color: var(--text-dark);
        }

        /* Main Card */
        .main-card {
            background: var(--bg-white);
            border-radius: var(--radius-lg);
            padding: 40px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
            border: 1px solid var(--border-light);
        }

        /* File Upload - Enhanced */
        .file-upload-container {
            border: 3px dashed var(--primary);
            border-radius: var(--radius-lg);
            padding: 60px 40px;
            text-align: center;
            margin: 30px 0;
            background: linear-gradient(135deg, #fff9 0%, #f0fff0 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .file-upload-container {
            background: linear-gradient(135deg, #1e3a1e 0%, #2d4a2d 100%);
        }

        .file-upload-container:hover {
            border-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .upload-icon {
            font-size: 5rem;
            color: var(--primary);
            margin-bottom: 20px;
            filter: drop-shadow(0 4px 8px rgba(46, 139, 87, 0.3));
        }

        /* Buttons - Enhanced */
        .btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin: 8px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(46, 139, 87, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn:disabled::before {
            display: none;
        }

        /* Text Areas - Enhanced */
        .text-preview-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 40px 0;
        }

        @media (max-width: 1024px) {
            .text-preview-container {
                grid-template-columns: 1fr;
            }
        }

        .text-preview {
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 25px;
            background: var(--bg-white);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .text-preview:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .text-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-light);
        }

        .text-preview h3 {
            color: var(--primary);
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .text-content {
            width: 100%;
            height: 300px;
            border: 1px solid var(--border-light);
            border-radius: var(--radius);
            padding: 20px;
            font-family: 'Hind Siliguri', sans-serif;
            font-size: 16px;
            line-height: 1.8;
            resize: none;
            background: var(--bg-light);
            color: var(--text-dark);
            overflow-y: auto;
        }

        .text-content:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        /* Reader Modal */
        .reader-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .reader-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 85%;
            background: var(--bg-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .reader-header {
            padding: 20px;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-light);
        }

        .reader-body {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            line-height: 2;
            font-size: 18px;
        }

        .reader-controls {
            padding: 20px;
            background: var(--bg-light);
            border-top: 1px solid var(--border-light);
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }

        /* History Section */
        .history-section {
            display: none;
        }

        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .history-card {
            background: var(--bg-white);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .history-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .history-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-title {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1.1rem;
        }

        .history-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .history-preview {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Progress Bar - Enhanced */
        .progress-container {
            width: 100%;
            background: var(--bg-light);
            border-radius: 50px;
            margin: 25px 0;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-bar {
            height: 25px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 50px;
            transition: width 0.4s ease;
            text-align: center;
            color: white;
            font-size: 14px;
            font-weight: 600;
            line-height: 25px;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Loading Animation - Enhanced */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border-light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 3;
        }

        /* Dark/Light Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #2196F3;
            transition: 0.4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #ff9800;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 0;
            color: var(--text-light);
            border-top: 1px solid var(--border-light);
            margin-top: 50px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .title {
                font-size: 2.2rem;
            }
            .subtitle {
                font-size: 1.1rem;
            }
            .nav-tabs {
                flex-direction: column;
                gap: 10px;
            }
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            .btn {
                width: 100%;
                justify-content: center;
            }
            .reader-content {
                width: 95%;
                height: 90%;
            }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .hidden { display: none; }

        /* Arabic Text Style */
        .arabic-text {
            font-family: 'Amiri', serif;
            font-size: 20px;
            line-height: 2.5;
            text-align: right;
            direction: rtl;
        }

        /* Bangla Text Style */
        .bangla-text {
            font-family: 'Hind Siliguri', sans-serif;
            font-size: 18px;
            line-height: 1.8;
            text-align: justify;
        }

        /* File Info */
        .file-info {
            background: var(--bg-light);
            padding: 15px;
            border-radius: var(--radius);
            margin: 15px 0;
            border-left: 4px solid var(--primary);
        }

        .file-name {
            font-weight: 600;
            color: var(--primary);
        }

        .file-size {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* TTS Controls */
        .tts-active {
            background: #dc3545 !important;
        }

        .tts-active:hover {
            background: #c82333 !important;
        }

        /* API Status */
        .api-status {
            padding: 10px 15px;
            border-radius: var(--radius);
            margin: 10px 0;
            text-align: center;
            font-weight: 600;
        }

        .api-status.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .api-status.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .api-status.warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        /* Stop Button Animation */
        .stop-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="theme-toggle">
                <label class="switch">
                    <input type="checkbox" id="themeToggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="logo-container">
                <div class="logo">لَا إِلٰهَ إِلَّا الله</div>
                <h1 class="title">Al Bayan</h1>
                <p class="subtitle">আরবি ইসলামিক বই অনুবাদ</p>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showTab('translate')">
                <i class="fas fa-translate"></i> অনুবাদ করুন
            </div>
            <div class="nav-tab" onclick="showTab('history')">
                <i class="fas fa-history"></i> ইতিহাস
            </div>
            <div class="nav-tab" onclick="showTab('library')">
                <i class="fas fa-book"></i> লাইব্রেরি
            </div>
        </div>

        <!-- Translation Tab -->
        <div id="translate-tab" class="main-card">
            <!-- API Status -->
            <div id="apiStatus" class="api-status warning">
                <i class="fas fa-exclamation-triangle"></i> জিমিনি API টি প্রয়োজন। নিচে আপনার API টি দিন।
            </div>

            <!-- API Key Input -->
            <div style="background: var(--bg-light); padding: 20px; border-radius: var(--radius); margin: 20px 0; border-left: 4px solid var(--primary);">
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <input type="password" id="apiKeyInput" placeholder="এখানে আপনার জিমিনি API কী দিন" 
                           style="flex: 1; padding: 12px 15px; border: 1px solid var(--border-light); border-radius: var(--radius); font-family: 'Hind Siliguri'; min-width: 250px;">
                    <button class="btn" onclick="saveApiKey()" style="padding: 12px 20px;">
                        <i class="fas fa-save"></i> সংরক্ষণ করুন
                    </button>
                    <button class="btn btn-secondary" onclick="testApiKey()" style="padding: 12px 20px;">
                        <i class="fas fa-test"></i> টেস্ট করুন
                    </button>
                </div>
                <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-light);">
                    🔑 API  পাবেন: <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: var(--primary);">Google AI Studio</a> থেকে
                </p>
            </div>

            <!-- File Upload -->
            <div class="file-upload-container" id="fileUploadArea">
                <div class="upload-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <h3 style="font-size: 2rem; margin-bottom: 15px; color: var(--text-dark);">PDF ফাইল আপলোড করুন</h3>
                <p style="font-size: 1.2rem; color: var(--text-light); margin-bottom: 30px;">আরবি ইসলামিক বইয়ের PDF সিলেক্ট করুন (সর্বোচ্চ ২০ এমবি)</p>
                <input type="file" id="pdfFile" accept=".pdf" hidden>
                <button class="btn btn-gold" onclick="document.getElementById('pdfFile').click()">
                    <i class="fas fa-upload"></i> PDF সিলেক্ট করুন
                </button>
            </div>

            <!-- File Info Display -->
            <div id="fileInfo" class="file-info" style="display: none;">
                <div class="file-name" id="fileName"></div>
                <div class="file-size" id="fileSize"></div>
            </div>

            <!-- PDF Type Selection -->
            <div style="background: #fff3cd; padding: 20px; border-radius: var(--radius); margin: 20px 0; text-align: center; border-left: 4px solid #ffc107;">
                <strong>📄 PDF টাইপ সিলেক্ট করুন:</strong>
                <div style="display: flex; justify-content: center; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
                    <div class="pdf-type-option active" data-type="text" onclick="selectPdfType('text')" style="display: flex; align-items: center; gap: 8px; padding: 10px 15px; background: white; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                        <i class="fas fa-font"></i>
                        <span>সাধারণ PDF (টেক্সট)</span>
                    </div>
                    <div class="pdf-type-option" data-type="ocr" onclick="selectPdfType('ocr')" style="display: flex; align-items: center; gap: 8px; padding: 10px 15px; background: white; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                        <i class="fas fa-camera"></i>
                        <span>স্ক্যান করা PDF (OCR)</span>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn" onclick="extractAndTranslate()" id="extractTranslateBtn">
                    <i class="fas fa-bolt"></i> একসাথে এক্সট্র্যাক্ট ও অনুবাদ করুন
                </button>
                <button class="btn btn-danger stop-pulse" onclick="stopTranslation()" id="stopBtn" style="display: none;">
                    <i class="fas fa-stop"></i> অনুবাদ বন্ধ করুন
                </button>
                <button class="btn btn-secondary" onclick="clearAll()">
                    <i class="fas fa-redo"></i> রিসেট করুন
                </button>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container" id="progressContainer" style="display: none;">
                <div class="progress-bar" id="progressBar" style="width: 0%">0%</div>
            </div>

            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p id="loadingText" style="font-size: 1.2rem; color: var(--text-light);">অনুবাদ করা হচ্ছে... অনুগ্রহ করে অপেক্ষা করুন</p>
            </div>

            <!-- Text Preview -->
            <div class="text-preview-container">
                <div class="text-preview">
                    <div class="text-preview-header">
                        <h3><i class="fas fa-language"></i> আরবি টেক্সট</h3>
                        <button class="btn" onclick="openReader('arabic')" style="padding: 8px 15px; font-size: 0.9rem;">
                            <i class="fas fa-expand"></i> বড় করে পড়ুন
                        </button>
                    </div>
                    <textarea class="text-content arabic-text" id="arabicText" placeholder="এখানে আরবি টেক্সট দেখানো হবে..." readonly></textarea>
                </div>
                <div class="text-preview">
                    <div class="text-preview-header">
                        <h3><i class="fas fa-translate"></i> বাংলা অনুবাদ</h3>
                        <button class="btn" onclick="openReader('bangla')" style="padding: 8px 15px; font-size: 0.9rem;">
                            <i class="fas fa-expand"></i> বড় করে পড়ুন
                        </button>
                    </div>
                    <textarea class="text-content bangla-text" id="banglaText" placeholder="এখানে বাংলা অনুবাদ দেখানো হবে..." readonly></textarea>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history-tab" class="main-card hidden">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">
                <i class="fas fa-history"></i> আপনার অনুবাদ ইতিহাস
            </h2>
            <div class="history-grid" id="historyGrid">
                <!-- History items will be dynamically added here -->
                <div style="text-align: center; color: var(--text-light); padding: 40px;">
                    <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 20px;"></i>
                    <p>কোনো অনুবাদ ইতিহাস নেই</p>
                </div>
            </div>
        </div>

        <!-- Library Tab -->
        <div id="library-tab" class="main-card hidden">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">
                <i class="fas fa-book"></i> ইসলামিক লাইব্রেরি
            </h2>
            <div style="text-align: center; color: var(--text-light); margin-bottom: 40px;">
                <p>শীঘ্রই আসছে... প্রিসেট ইসলামিক বইগুলোর সংগ্রহ</p>
            </div>
        </div>
    </div>

    <!-- Reader Modal -->
    <div class="reader-modal" id="readerModal">
        <div class="reader-content">
            <div class="reader-header">
                <h3 id="readerTitle">বাংলা অনুবাদ</h3>
                <button class="btn" onclick="closeReader()" style="padding: 8px 15px; background: rgba(255,255,255,0.2);">
                    <i class="fas fa-times"></i> বন্ধ করুন
                </button>
            </div>
            <div class="reader-body" id="readerBody">
                <!-- Content will be dynamically added -->
            </div>
            <div class="reader-controls">
                <button class="btn" onclick="changeFontSize(-2)" style="padding: 8px 15px;">
                    <i class="fas fa-font"></i> ছোট
                </button>
                <button class="btn" onclick="changeFontSize(2)" style="padding: 8px 15px;">
                    <i class="fas fa-font"></i> বড়
                </button>
                <button class="btn" onclick="toggleDarkReader()" style="padding: 8px 15px;">
                    <i class="fas fa-moon"></i> নাইট মোড
                </button>
                <button class="btn" id="ttsButton" onclick="toggleSpeakText()" style="padding: 8px 15px;">
                    <i class="fas fa-volume-up"></i> পড়ুন
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>© ২০২৫ কুরআন বাংলা - ইসলামিক জ্ঞান বাংলাভাষীদের মাঝে ছড়িয়ে দিন</p>
        <p style="margin-top: 10px; font-size: 0.9em;">
            
            বাকিয়াহ ইনস্টিটিউট দ্বারা পরিচালিত
        </p>
    </footer>

    <script>
        // Global variables
        let extractedText = '';
        let selectedPdfType = 'text';
        let tesseractWorker = null;
        let currentFile = null;
        let isSpeaking = false;
        let speechSynthesis = window.speechSynthesis;
        let GEMINI_API_KEY = '';
        let isTranslationRunning = false;
        let currentTranslationProcess = null;

        // Gemini API Configuration
        const GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent";

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            loadApiKey();
            setupEventListeners();
            loadHistory();
        });

        // Load API Key from localStorage
        function loadApiKey() {
            const savedKey = localStorage.getItem('gemini_api_key');
            if (savedKey) {
                GEMINI_API_KEY = savedKey;
                document.getElementById('apiKeyInput').value = '••••••••••••••••';
                updateApiStatus('success', '✅ API কী লোড হয়েছে! আপনি এখন অনুবাদ করতে পারেন।');
            }
        }

        // Save API Key
        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (!apiKey) {
                alert('দয়া করে একটি বৈধ API কী দিন।');
                return;
            }

            // If input is masked, don't save the mask
            if (apiKey === '••••••••••••••••') {
                return;
            }

            GEMINI_API_KEY = apiKey;
            localStorage.setItem('gemini_api_key', apiKey);
            document.getElementById('apiKeyInput').value = '••••••••••••••••';
            updateApiStatus('success', '✅ API কী সংরক্ষণ করা হয়েছে! আপনি এখন অনুবাদ করতে পারেন।');
        }

        // Test API Key
        async function testApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            
            if (!apiKey || apiKey === '••••••••••••••••') {
                if (!GEMINI_API_KEY) {
                    alert('দয়া করে প্রথমে একটি API কী দিন।');
                    return;
                }
                // Use existing key
            } else {
                GEMINI_API_KEY = apiKey;
                localStorage.setItem('gemini_api_key', apiKey);
            }

            showLoading('API কী টেস্ট করা হচ্ছে...');

            try {
                const testResult = await translateWithGemini('سلام', true);
                if (testResult.includes('API_ERROR')) {
                    throw new Error('API কীটি বৈধ নয়');
                }
                updateApiStatus('success', '✅ API কী সঠিক! আপনি এখন অনুবাদ করতে পারেন।');
            } catch (error) {
                updateApiStatus('error', '❌ API কী ত্রুটি: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Update API Status
        function updateApiStatus(type, message) {
            const statusDiv = document.getElementById('apiStatus');
            statusDiv.className = `api-status ${type}`;
            statusDiv.innerHTML = message;
        }

        // Theme functionality
        function initializeTheme() {
            const themeToggle = document.getElementById('themeToggle');
            const savedTheme = localStorage.getItem('theme') || 'light';
            
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.checked = true;
            }

            themeToggle.addEventListener('change', function() {
                if (this.checked) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.setAttribute('data-theme', 'light');
                    localStorage.setItem('theme', 'light');
                }
            });
        }

        // Event listeners
        function setupEventListeners() {
            // File upload handling
            document.getElementById('pdfFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                currentFile = file;
                displayFileInfo(file);
            });
        }

        // Display file information
        function displayFileInfo(file) {
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            
            const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
            
            fileName.textContent = file.name;
            fileSize.textContent = `আকার: ${fileSizeMB} MB`;
            fileInfo.style.display = 'block';

            // Show warning for large files
            if (file.size > 10 * 1024 * 1024) {
                showWarning(`বড় ফাইল (${fileSizeMB} MB): প্রসেসিং বেশি সময় নিতে পারে।`);
            }
        }

        // PDF type selection
        function selectPdfType(type) {
            selectedPdfType = type;
            document.querySelectorAll('.pdf-type-option').forEach(opt => {
                opt.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
        }

        // Stop translation function
        function stopTranslation() {
            if (isTranslationRunning) {
                isTranslationRunning = false;
                document.getElementById('stopBtn').style.display = 'none';
                document.getElementById('extractTranslateBtn').disabled = false;
                hideLoading();
                document.getElementById('progressContainer').style.display = 'none';
                showWarning('অনুবাদ বন্ধ করা হয়েছে!');
                
                // Clean up Tesseract worker if it exists
                if (tesseractWorker) {
                    tesseractWorker.terminate();
                    tesseractWorker = null;
                }
            }
        }

        // Main translation function
        async function extractAndTranslate() {
            if (!currentFile) {
                alert('দয়া করে প্রথমে একটি PDF ফাইল সিলেক্ট করুন।');
                return;
            }

            if (!GEMINI_API_KEY) {
                alert('দয়া করে প্রথমে একটি বৈধ জিমিনি API কী সেট করুন।');
                document.getElementById('apiKeyInput').focus();
                return;
            }

            // File size validation
            if (currentFile.size > 20 * 1024 * 1024) {
                alert('ফাইল খুব বড়! দয়া করে ২০ এমবি-এর ছোট ফাইল আপলোড করুন।');
                return;
            }

            const extractTranslateBtn = document.getElementById('extractTranslateBtn');
            extractTranslateBtn.disabled = true;
            document.getElementById('stopBtn').style.display = 'inline-flex';
            isTranslationRunning = true;

            try {
                showLoading('PDF প্রসেস করা হচ্ছে...');
                
                if (selectedPdfType === 'ocr') {
                    await extractWithOCRAndTranslate(currentFile);
                } else {
                    await extractNormalAndTranslate(currentFile);
                }
                
                if (isTranslationRunning) {
                    // Save to history only if not stopped
                    saveToHistory();
                }
                
            } catch (error) {
                if (isTranslationRunning) {
                    console.error('Translation error:', error);
                    alert('ত্রুটি: ' + (error.message || 'অনুবাদ করতে সমস্যা হয়েছে'));
                }
            } finally {
                if (isTranslationRunning) {
                    extractTranslateBtn.disabled = false;
                    document.getElementById('stopBtn').style.display = 'none';
                    hideLoading();
                    isTranslationRunning = false;
                }
            }
        }

        // Normal PDF extraction with translation
        async function extractNormalAndTranslate(file) {
            try {
                const pdf = await pdfjsLib.getDocument(await file.arrayBuffer()).promise;
                const totalPages = Math.min(pdf.numPages, 400); // 20 pages maximum
                let arabicText = '';
                let banglaTranslation = '';

                document.getElementById('progressContainer').style.display = 'block';

                for (let i = 1; i <= totalPages; i++) {
                    // Check if translation was stopped
                    if (!isTranslationRunning) {
                        console.log('Translation stopped by user');
                        return;
                    }

                    showLoading(`পৃষ্ঠা ${i}/${totalPages} প্রসেস করা হচ্ছে...`);
                    
                    // Extract text from page
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    const pageText = content.items.map(item => item.str).join(' ');
                    
                    if (pageText.trim().length > 0) {
                        arabicText += `পৃষ্ঠা ${i}:\n${pageText}\n\n`;
                        document.getElementById('arabicText').value = arabicText;

                        // Use actual Gemini API for translation
                        const translatedText = await translateWithGemini(pageText);
                        banglaTranslation += `পৃষ্ঠা ${i}:\n${translatedText}\n\n`;
                        document.getElementById('banglaText').value = banglaTranslation;
                    }

                    // Update progress
                    const progress = Math.round((i / totalPages) * 100);
                    updateProgress(progress);

                    // Add delay to prevent rate limiting
                    await delay(2000);
                }

                if (isTranslationRunning) {
                    extractedText = arabicText;
                    document.getElementById('progressContainer').style.display = 'none';
                    showSuccess(`${totalPages} পৃষ্ঠা সফলভাবে অনুবাদ করা হয়েছে!`);
                }

            } catch (error) {
                if (isTranslationRunning) {
                    throw new Error('PDF পড়তে সমস্যা: ' + error.message);
                }
            }
        }

        // OCR extraction with translation
        async function extractWithOCRAndTranslate(file) {
            showLoading('OCR প্রস্তুত করা হচ্ছে...');
            
            try {
                if (!tesseractWorker) {
                    tesseractWorker = await Tesseract.createWorker('ara');
                }

                const pdf = await pdfjsLib.getDocument(await file.arrayBuffer()).promise;
                const totalPages = Math.min(pdf.numPages, 10); // 10 pages maximum for OCR
                let arabicText = '';
                let banglaTranslation = '';

                document.getElementById('progressContainer').style.display = 'block';

                for (let i = 1; i <= totalPages; i++) {
                    // Check if translation was stopped
                    if (!isTranslationRunning) {
                        console.log('Translation stopped by user');
                        if (tesseractWorker) {
                            tesseractWorker.terminate();
                            tesseractWorker = null;
                        }
                        return;
                    }

                    showLoading(`পৃষ্ঠা ${i}/${totalPages} OCR করা হচ্ছে...`);
                    
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({ scale: 1.5 });
                    
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    
                    await page.render({
                        canvasContext: context,
                        viewport: viewport
                    }).promise;

                    const { data: { text } } = await tesseractWorker.recognize(canvas);
                    
                    if (text.trim().length > 0) {
                        arabicText += `পৃষ্ঠা ${i}:\n${text}\n\n`;
                        document.getElementById('arabicText').value = arabicText;

                        // Use actual Gemini API for translation
                        const translatedText = await translateWithGemini(text);
                        banglaTranslation += `পৃষ্ঠা ${i}:\n${translatedText}\n\n`;
                        document.getElementById('banglaText').value = banglaTranslation;
                    }

                    // Update progress
                    const progress = Math.round((i / totalPages) * 100);
                    updateProgress(progress);

                    await delay(2500);
                }

                if (isTranslationRunning) {
                    extractedText = arabicText;
                    document.getElementById('progressContainer').style.display = 'none';
                    showSuccess(`${totalPages} পৃষ্ঠা OCR এবং অনুবাদ সম্পূর্ণ!`);
                }

            } catch (error) {
                if (isTranslationRunning) {
                    throw new Error('OCR ত্রুটি: ' + error.message);
                }
            }
        }

        // Real Gemini API translation
        async function translateWithGemini(text, isTest = false) {
            if (!GEMINI_API_KEY) {
                throw new Error('API কী পাওয়া যায়নি। দয়া করে API কী সেট করুন।');
            }

            // Check if translation was stopped
            if (!isTranslationRunning) {
                return "অনুবাদ বন্ধ করা হয়েছে";
            }

            try {
                const apiUrl = `${GEMINI_API_URL}?key=${GEMINI_API_KEY}`;
                
                const requestBody = {
                    contents: [{
                        parts: [{
                            text: `Translate this Arabic Islamic text to natural Bangla accurately. Preserve religious meaning and Islamic terminology. Keep the translation concise and natural. Only return the translated text, no additional comments.
                            
                            Arabic Text: ${text.substring(0, 3000)}`
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.3,
                        topK: 40,
                        topP: 0.8,
                        maxOutputTokens: 2000,
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                }

                const data = await response.json();
                const translatedText = data.candidates[0].content.parts[0].text;
                
                if (isTest) {
                    return 'API_TEST_SUCCESS';
                }
                
                return translatedText;

            } catch (error) {
                console.error('Gemini API error:', error);
                if (isTest) {
                    return 'API_ERROR: ' + error.message;
                }
                throw new Error(`অনুবাদ ব্যর্থ: ${error.message}`);
            }
        }

        // Utility functions
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function showLoading(message) {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('loadingText').textContent = message;
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressBar').textContent = percent + '%';
        }

        function showWarning(message) {
            alert('⚠️ ' + message);
        }

        function showSuccess(message) {
            alert('✅ ' + message);
        }

        // Tab navigation
        function showTab(tabName) {
            document.querySelectorAll('.main-card').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            event.currentTarget.classList.add('active');
        }

        // Reader functionality
        function openReader(type) {
            const modal = document.getElementById('readerModal');
            const title = document.getElementById('readerTitle');
            const body = document.getElementById('readerBody');
            
            let content = '';
            if (type === 'arabic') {
                title.textContent = 'আরবি টেক্সট';
                content = document.getElementById('arabicText').value || 'কোনো টেক্সট নেই';
                body.innerHTML = `<div class="arabic-text" style="font-size: 24px; line-height: 3;">${content}</div>`;
            } else {
                title.textContent = 'বাংলা অনুবাদ';
                content = document.getElementById('banglaText').value || 'কোনো অনুবাদ নেই';
                body.innerHTML = `<div class="bangla-text" style="font-size: 20px; line-height: 2;">${content}</div>`;
            }
            
            modal.style.display = 'block';
            
            // Stop any ongoing speech when opening reader
            stopSpeech();
        }

        function closeReader() {
            // Stop speech when closing reader
            stopSpeech();
            document.getElementById('readerModal').style.display = 'none';
        }

        function changeFontSize(delta) {
            const body = document.getElementById('readerBody');
            const currentSize = parseInt(window.getComputedStyle(body.querySelector('div')).fontSize);
            const newSize = Math.max(12, Math.min(40, currentSize + delta));
            body.querySelector('div').style.fontSize = newSize + 'px';
        }

        function toggleDarkReader() {
            const body = document.getElementById('readerBody');
            const isDark = body.style.backgroundColor === 'rgb(26, 32, 44)';
            
            if (isDark) {
                body.style.backgroundColor = '';
                body.style.color = '';
            } else {
                body.style.backgroundColor = '#1A202C';
                body.style.color = '#CBD5E0';
            }
        }

        // Text-to-speech with toggle functionality
        function toggleSpeakText() {
            if (isSpeaking) {
                stopSpeech();
            } else {
                speakText();
            }
        }

        function speakText() {
            const text = document.getElementById('readerBody').textContent;
            if (!text || text === 'কোনো অনুবাদ নেই' || text === 'কোনো টেক্সট নেই') {
                alert('পড়ার জন্য কোনো টেক্সট নেই।');
                return;
            }

            if ('speechSynthesis' in window) {
                stopSpeech(); // Stop any ongoing speech first
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'bn-BD';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                
                // Update button state
                isSpeaking = true;
                const ttsButton = document.getElementById('ttsButton');
                ttsButton.innerHTML = '<i class="fas fa-stop"></i> থামুন';
                ttsButton.classList.add('tts-active');
                
                // Handle speech end
                utterance.onend = function() {
                    stopSpeech();
                };
                
                // Handle speech error
                utterance.onerror = function() {
                    stopSpeech();
                    alert('Text-to-speech ত্রুটি হয়েছে।');
                };
                
                speechSynthesis.speak(utterance);
            } else {
                alert('Text-to-speech is not supported in your browser.');
            }
        }

        function stopSpeech() {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
            }
            isSpeaking = false;
            const ttsButton = document.getElementById('ttsButton');
            ttsButton.innerHTML = '<i class="fas fa-volume-up"></i> পড়ুন';
            ttsButton.classList.remove('tts-active');
        }

        // History functionality
        function saveToHistory() {
            const history = JSON.parse(localStorage.getItem('translationHistory') || '[]');
            const newItem = {
                id: Date.now(),
                title: currentFile?.name || 'অনুবাদ',
                arabicText: document.getElementById('arabicText').value.substring(0, 200) + '...',
                banglaText: document.getElementById('banglaText').value.substring(0, 200) + '...',
                date: new Date().toLocaleDateString('bn-BD')
            };
            
            history.unshift(newItem);
            localStorage.setItem('translationHistory', JSON.stringify(history));
            loadHistory();
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('translationHistory') || '[]');
            const historyGrid = document.getElementById('historyGrid');
            
            if (history.length === 0) {
                historyGrid.innerHTML = `
                    <div style="text-align: center; color: var(--text-light); padding: 40px;">
                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <p>কোনো অনুবাদ ইতিহাস নেই</p>
                    </div>
                `;
                return;
            }

            historyGrid.innerHTML = history.map(item => `
                <div class="history-card" onclick="loadHistoryItem(${item.id})">
                    <div class="history-card-header">
                        <div class="history-title">${item.title}</div>
                        <div class="history-date">${item.date}</div>
                    </div>
                    <div class="history-preview">${item.banglaText}</div>
                </div>
            `).join('');
        }

        function loadHistoryItem(id) {
            const history = JSON.parse(localStorage.getItem('translationHistory') || '[]');
            const item = history.find(h => h.id === id);
            
            if (item) {
                // For demo, we only have preview text in history
                // In real implementation, you'd store full text
                document.getElementById('arabicText').value = item.arabicText;
                document.getElementById('banglaText').value = item.banglaText;
                showTab('translate');
                showSuccess('ইতিহাস থেকে লোড করা হয়েছে!');
            }
        }

        // Clear all function
        function clearAll() {
            // Stop any ongoing translation first
            stopTranslation();
            
            document.getElementById('pdfFile').value = '';
            document.getElementById('arabicText').value = '';
            document.getElementById('banglaText').value = '';
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            currentFile = null;
            extractedText = '';
            
            // Stop any ongoing speech
            stopSpeech();
            
            alert('সব কিছু রিসেট করা হয়েছে।');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('readerModal');
            if (event.target === modal) {
                closeReader();
            }
        }

        // Stop speech when page is hidden
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                stopSpeech();
            }
        });
    </script>
</body>
</html>
